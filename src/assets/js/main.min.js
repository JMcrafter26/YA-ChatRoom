function logOut(){$("#logoutBtn").prop("disabled",!0),$("#logoutBtn").html('Logging out <i class="fas fa-circle-notch fa-spin"></i>'),$.ajax({url:"api.php",type:"GET",data:{action:"logout",token:window.config.ctoken},success:function(e){"success"==e.status?window.location.reload():$("#error").html(e.message)},error:function(){$("#error").html("An error occurred")}}),$("#logoutBtn").prop("disabled",!1),$("#logoutBtn").html('Logout <i class="fas fa-sign-out-alt"></i>')}function loadData(){var e=!0;(e=!$("#sendBusyStatusSwitch").is(":checked")||!!document.hasFocus())?($("#yourStatus").removeClass("bg-warning"),$("#yourStatus").addClass("bg-success")):($("#yourStatus").removeClass("bg-success"),$("#yourStatus").addClass("bg-warning")),null!=window.lastFocus&&null!=window.lastFocus||(window.lastFocus=Math.floor(Date.now()/1e3)),document.hasFocus()&&(window.lastFocus=Math.floor(Date.now()/1e3)),null!=window.lastMsgHash&&null!=window.lastMsgHash||(window.lastMsgHash=0),$.ajax({url:"api.php",type:"GET",data:{action:"getChat",token:window.config.token,focus:e,lastHash:window.lastMsgHash},success:function(a){if("success"==a.status){$("#users").html("");var t=[],s=[];null!=window.usersList&&null!=window.usersList||(window.usersList=a.data.users),$.each(window.usersList,(function(e,t){a.data.users.some((e=>e.name===t.name))||s.push(t)})),$.each(a.data.users,(function(e,a){if(a.name!=window.config.name){window.usersList.some((e=>e.name===a.name))||t.push(a);var s=a.status;if($("#users").append('<li class="list-group-item d-flex justify-content-between align-items-center"><span class="status '+s+'"></span><span class="fw-bold">'+a.name+'<span class="badge" style="background-color: #'+a.color+'; padding: 3px; margin-left: 2px;" title="#'+a.color+'" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="#'+a.color+'" data-bs-custom-class="tooltip-color-'+a.color+'" >#<span class="d-lg-none">'+a.color+'</span></span></span><span class="fi flag-icon fi-'+a.countryCode.toLowerCase()+'"></span></li>'),0==$(".tooltip-color-"+a.color).length){var n=document.createElement("style");n.type="text/css",n.innerHTML=".tooltip-color-"+a.color+" .tooltip-inner { background-color: #"+a.color+"; color: #fff; }",document.getElementsByTagName("head")[0].appendChild(n)}}else window.yourColor=a.color})),$("#userCount").html(a.data.users.length),$("#userCountMobile").html(a.data.users.length),window.usersList=a.data.users;[...document.querySelectorAll('[data-bs-toggle="tooltip"]')].map((e=>new bootstrap.Tooltip(e)));var n=!1;$("#messages").find(".spinner-border").length>0&&($("#messages").html(""),n=!0);var o=$("#messages").scrollTop();if(o>=$("#messages")[0].scrollHeight-$("#messages").height()-100)var i=!0;else i=!1;var l=0;if($.each(a.data.chats,(function(a,t){var s="",n=!1;if(1==t.spam&&1==getFromStorage("hideSpamMessages")?(s="d-none spam-message",n=!0):1==t.spam?(s="spam-message",n=!0):(s="",n=!1),!e&&t.time>window.lastFocus&&0==n&&l++,$('li[data-hash="'+t.hash+'"]').length>0)return;1==t.spam&&(document.getElementById("spamCount").innerText=parseInt(document.getElementById("spamCount").innerText)+1),t.name=DOMPurify.sanitize(t.name),t.message=DOMPurify.sanitize(t.message);var o="000000";$.each(window.usersList,(function(e,a){a.name==t.name&&(o=a.color)})),t.color=o,t.name==window.config.name&&(t.name=t.name+' <span class="badge" style="background-color: #'+t.color+';">You</span>');const i=new Date(1e3*t.time),r=i.getHours(),c="0"+i.getMinutes(),d="0"+i.getSeconds(),m=r+":"+c.substr(-2)+":"+d.substr(-2);t.message=t.message.replace(/(https?:\/\/[^\s]+)/g,(function(e){return'<a data-href="'+e+'" class="msg-url" href="javascript:void(0)">'+e+"</a>"})),"//frog.gif//"==t.message&&(t.message='<img src="assets/emojis/frog.gif" alt="frog" style="height: 2rem; user-select: none; pointer-events: none; draggable: false;">'),t.message.includes("//frog.gif//")&&(t.message=t.message.replace("//frog.gif//",""));var h=`<span class="badge" style="background-color: #${t.color};">#${t.color}</span>`;t.name.includes("You")&&(h="");const u=`<li class="list-group-item ${s}" data-hash="${t.hash}" data-spam="${n}">\n                        <div class="row">\n                            <div class="col-12 d-flex justify-content-between align-items-center">\n                                <div class="fw-bold">${t.name} ${h}</div>\n                                <div class="text-muted">${m}</div>\n                                \n                            </div>\n                        </div>\n                        <div class="row">\n                            <div class="col-12">\n                                <p class="mb-0">${t.message}</p>\n                                </div>\n\n                        </div>\n                    </li>`;$("#messages").append(u),window.lastMsgHash=t.hash})),n){const e='<li class="list-group-item" data-hash="0">\n\n                    <div class="row">\n                        <div class="col-12 user-select-none">\n                            <p class="mb-0 fw-bold">Welcome to the chat!</p>\n                            <p class="mb-0">Please be respectful to others and follow the rules.</p>\n                            <p class="mb-0">The messages are only stored for 1 minute, if you refresh the page, the old messages will be gone.</p>\n                            <p class="mb-0 text-warning"><i class="fas fa-exclamation-triangle"></i> Please do not share any personal information, as this is a public chat <i class="fas fa-exclamation-triangle"></i></p>\n                            <p class="mb-0">Have fun! <i class="far fa-smile"></i></p>\n                        </div>\n                    </div>\n                </li>';$("#messages").append(e)}1!=getFromStorage("joinMessages")&&(t=[],s=[]),$.each(t,(function(e,a){var t=["Welcome to the chat, "+a.name+"!","Hello, "+a.name+"!","User "+a.name+" has joined the chat!","New user "+a.name+" has joined the chat!","Welcome, "+a.name+"!","User "+a.name+" has entered the chat!","A wild "+a.name+" has appeared!","User "+a.name+" has arrived!","User "+a.name+" has joined!"];if(t=(t=t[Math.floor(Math.random()*t.length)]).replace(a.name,'<span class="fw-bold text-info">'+a.name+"</span>"),"someone26"==a.name){var s=document.createElement("style");s.type="text/css",s.innerHTML="\n                        .textcontainer{padding:20px 0;text-align:center}.particletext{text-align:center;font-size:24px;position:relative;&.bubbles{>.particle{opacity:0;position:absolute;background-color:rgba(33,150,243,.5);animation:bubbles 3s ease-in infinite;border-radius:100%}}&.confetti{>.particle{opacity:0;position:absolute;animation:confetti 3s ease-in infinite;&.c1{background-color:rgba(76,175,80,.5)}&.c2{background-color:rgba(156,39,176,.5)}}}}@keyframes confetti{0%{opacity:0;transform:translateY(0%) rotate(0deg)}10%{opacity:1}35%{transform:translateY(-800%) rotate(270deg)}80%{opacity:1}100%{opacity:0;transform:translateY(2000%) rotate(1440deg)}}\n                        ",document.getElementsByTagName("head")[0].appendChild(s),t='<div class="textcontainer"><span class="particletext confetti">Someone26</span></div> has joined the chat!'}const n=`<li class="list-group-item" data-hash="0">\n                    <div class="row">\n                        <div class="col-12 user-select-none">\n                            <p class="mb-0 fw-bold">${t}</p>\n                        </div>\n                    </div>\n                </li>`;$("#messages").append(n),"someone26"==a.name&&confetti()})),$.each(s,(function(e,a){var t=[a.name+" has left the chat!",a.name+" has left!","User "+a.name+" has left the chat!","We lost "+a.name+"!",a.name+" disappeared!",a.name+" seems to be gone!",a.name+" said goodbye!",a.name+" has left us!"];const s=`<li class="list-group-item" data-hash="0">\n                    <div class="row">\n                        <div class="col-12 user-select-none">\n                            <p class="mb-0 fw-bold">${t=(t=t[Math.floor(Math.random()*t.length)]).replace(a.name,'<span class="fw-bold text-danger">'+a.name+"</span>")}</p>\n                        </div>\n                    </div>\n                </li>`;$("#messages").append(s)}));var r=$("#messages")[0].scrollHeight-$("#messages").height();i?$("#messages").scrollTop(r):$("#messages").scrollTop(o),$("#captchaModal").modal("hide"),setFaviconCount(e?"":l>0?l:"")}else null==a.errCode?$("#error").html(a.message):"invalid-token"==a.errCode||"token-expired"==a.errCode?logOut():"verify-captcha"==a.errCode?($("#error").html(a.message),verifyCaptcha()):$("#error").html(a.message)},error:function(){$("#error").html("An error occurred")}})}function verifyCaptcha(){$("#captchaModal").hasClass("show")||($("#iconCaptchaIframe").attr("src","./assets/iconcaptcha/iframe.php?token="+window.config.ctoken+"&r="+Math.floor(1e3*Math.random())),$("#captchaModal").modal("show"))}function saveSettings(){var e={darkMode:$("#darkModeSwitch").is(":checked"),faviconCount:$("#faviconCountSwitch").is(":checked"),sendBusyStatus:$("#sendBusyStatusSwitch").is(":checked"),hideSpamMessages:$("#hideSpamSwitch").is(":checked"),hideUrlWarning:!$("#showUrlWarningSwitch").is(":checked"),joinMessages:$("#joinMessagesSwitch").is(":checked")};e={...JSON.parse(localStorage.getItem("chat-settings")),...e},localStorage.setItem("chat-settings",JSON.stringify(e))}function saveToStorage(e,a){var t=JSON.parse(localStorage.getItem("chat-settings"));t[e]=a,localStorage.setItem("chat-settings",JSON.stringify(t))}function loadSettings(){var e=JSON.parse(localStorage.getItem("chat-settings"));e&&(null!=e.bsTheme&&setBootswatchTheme(e.bsTheme),$("#darkModeSwitch").prop("checked",e.darkMode),$("#faviconCountSwitch").prop("checked",e.faviconCount),$("#sendBusyStatusSwitch").prop("checked",e.sendBusyStatus),$("#hideSpamSwitch").prop("checked",e.hideSpamMessages),$("#showUrlWarningSwitch").prop("checked",!e.hideUrlWarning),$("#joinMessagesSwitch").prop("checked",e.joinMessages))}function getFromStorage(e){var a=JSON.parse(localStorage.getItem("chat-settings"));return null==a&&(saveSettings(),a=JSON.parse(localStorage.getItem("chat-settings"))),a[e]}function sendMessage(){var e=$("#messageArea").val();if(""==e||e.length>1e3||e.length<1)$("#error").html("Message must be between 1 and 1000 characters");else{$("#sendBtn").prop("disabled",!0),$("#sendBtn").html('<i class="fas fa-circle-notch fa-spin"></i>');var a=DOMPurify.sanitize(e);e=a,$.ajax({url:"api.php",type:"POST",data:{message:e,action:"send",token:window.config.token},success:function(e){if("success"==e.status)null!=e.data.spam&&1==e.data.spam?$("#error").html("Your message was marked as spam ("+e.data.spam_category+") and may not be visible to others"):$("#error").html(""),$("#messageArea").val(""),$("#sendBtn").prop("disabled",!1),$("#sendBtn").html('<i class="fas fa-paper-plane"></i>');else if(null!=e.errCode)if("spamming"==e.errCode){$("#sendBtn").prop("disabled",!0);var a=new Date(1e3*e.data.until).getTime(),t=(new Date).getTime(),s=a-t,n=Math.floor(s%6e4/1e3);$("#error").html(e.message+" Try again in "+n+" seconds");var o=setInterval((function(){var t=(new Date).getTime(),s=a-t,n=Math.floor(s%6e4/1e3);$("#error").html(e.message+" Try again in "+n+" seconds"),s<0&&(clearInterval(o),$("#error").html(""),$("#sendBtn").prop("disabled",!1),$("#sendBtn").html('<i class="fas fa-paper-plane"></i>'))}),1e3)}else $("#error").html(e.message),$("#sendBtn").prop("disabled",!1),$("#sendBtn").html('<i class="fas fa-paper-plane"></i>');else $("#error").html(e.message),$("#sendBtn").prop("disabled",!1),$("#sendBtn").html('<i class="fas fa-paper-plane"></i>')},error:function(){$("#error").html("An error occurred, this is most likely <strong>not</strong> your fault"),$("#sendBtn").prop("disabled",!1),$("#sendBtn").html('<i class="fas fa-paper-plane"></i>')}}),loadData()}}function linkOpen(e){1==getFromStorage("hideUrlWarning")?window.open(e.getAttribute("data-href"),"_blank"):(document.getElementById("urlInput").value=e.getAttribute("data-href"),document.getElementById("urlFavicon").src="https://www.google.com/s2/favicons?domain="+e.getAttribute("data-href").split("/")[2]+"&sz=128",$("#urlWarningModal").modal("show"))}function updateActivity(e=!1){loadData(),document.hasFocus()?e&&setTimeout((function(){updateActivity(!0)}),window.config.fetchInterval):e&&setTimeout((function(){updateActivity(!0)}),window.config.backgroundFetchInterval)}function setBootswatchTheme(e){document.getElementById("bootswatchLink").href=e,saveToStorage("bsTheme",e);for(var a=document.getElementById("themeList"),t=0;t<a.children.length;t++){var s=a.children[t];s.dataset.theme==e?(s.classList.add("border-primary"),s.querySelector("button").disabled=!0,s.querySelector("button").innerHTML="In use"):(s.classList.remove("border-primary"),s.querySelector("button").disabled=!1,s.querySelector("button").innerHTML="Use theme")}setVh()}function loadBootswatchThemeList(){const e=loadTheme(),a={0:{name:"Default",url:"https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css",slogan:"The default theme"},1:{name:"Vapor",url:"https://cdnjs.cloudflare.com/ajax/libs/bootswatch/5.3.2/vapor/bootstrap.min.css",slogan:"The cool secret theme"},2:{name:"Flatly",url:"https://cdnjs.cloudflare.com/ajax/libs/bootswatch/5.3.2/flatly/bootstrap.min.css",slogan:"Flat and modern"},3:{name:"Journal",url:"https://cdnjs.cloudflare.com/ajax/libs/bootswatch/5.3.2/journal/bootstrap.min.css",slogan:"Crisp and clean"},4:{name:"Litera",url:"https://cdnjs.cloudflare.com/ajax/libs/bootswatch/5.3.2/litera/bootstrap.min.css",slogan:"Only typography"},5:{name:"Lumen",url:"https://cdnjs.cloudflare.com/ajax/libs/bootswatch/5.3.2/lumen/bootstrap.min.css",slogan:"Light and shadow"},6:{name:"Materia",url:"https://cdnjs.cloudflare.com/ajax/libs/bootswatch/5.3.2/materia/bootstrap.min.css",slogan:"Material design"},7:{name:"Minty",url:"https://cdnjs.cloudflare.com/ajax/libs/bootswatch/5.3.2/minty/bootstrap.min.css",slogan:"A fresh feel"},8:{name:"Pulse",url:"https://cdnjs.cloudflare.com/ajax/libs/bootswatch/5.3.2/pulse/bootstrap.min.css",slogan:"Compact and vibrant"},9:{name:"Quartz",url:"https://cdnjs.cloudflare.com/ajax/libs/bootswatch/5.3.2/quartz/bootstrap.min.css",slogan:"Subtle and solid"},10:{name:"Sketchy",url:"https://cdnjs.cloudflare.com/ajax/libs/bootswatch/5.3.2/sketchy/bootstrap.min.css",slogan:"A hand-drawn look"},11:{name:"Slate",url:"https://cdnjs.cloudflare.com/ajax/libs/bootswatch/5.3.2/slate/bootstrap.min.css",slogan:"Shades of gunmetal"},12:{name:"Solar",url:"https://cdnjs.cloudflare.com/ajax/libs/bootswatch/5.3.2/solar/bootstrap.min.css",slogan:"A spin on Solarized"},13:{name:"Yeti",url:"https://cdnjs.cloudflare.com/ajax/libs/bootswatch/5.3.2/yeti/bootstrap.min.css",slogan:"A friendly foundation"}};window.themes=a;var t=document.getElementById("themeList");t.innerHTML="";for(const[o,i]of Object.entries(a))if(0!=o&&1!=o){var s="./assets/theme-thumbnail/"+e+"/"+i.name.toLowerCase()+".png",n=document.createElement("div");n.className="card m-1",n.dataset.theme=i.url,n.style="width: 15rem;",n.innerHTML=`<img class="card-img-top lazyload thumbnail" alt="${i.name}" src="${s}" style="height: 10rem; object-fit: cover;" onclick="window.open('${s}', '_blank')" loading="lazy">\n                        <div class="card-body">\n                            <h5 class="card-title">${i.name}</h5>\n                            <p class="card-text">${i.slogan}</p>\n                            <button type="button" class="btn btn-primary useTheme" data-theme="${i.url}">Use theme</button>\n                        </div>`,t.appendChild(n)}}function centerThumbnail(e){var a=window.innerWidth/2-(e.getBoundingClientRect().left+e.getBoundingClientRect().width/2);e.classList.add("thumbnail-hover"),Math.abs(a)<50||(a<0&&e.classList.add("thumbnail-left"),a>0&&e.classList.add("thumbnail-right"))}function runcommands(e){if("showMeTheSecrets"==$("#messageArea").val()){if($("#messageArea").val(""),$('li[data-hash="secret"]').length>0)return!0;const e='<li class="list-group-item" data-hash="secret">\n                    <div class="row">\n                        <div class="col-12 user-select-none">\n                            <p class="mb-0 fw-bold"><i class="fa-solid fa-user-secret"></i> Psst!</p>\n                            <p class="mb-0">This is a list of all the secret emojis and other commands:</p>\n                            <ul>\n                                <li><strong>showMeTheSecrets</strong> - Show this list</li>\n                                <li><strong>!clear</strong> - Clear all messages (only works for you)</li>\n                                <li><strong>!theme</strong> - Change the theme (e.g. !theme slate, there is also a secret theme!)</li>\n                                <li><strong>!reload</strong> - Reload the chat</li>\n                                <li><strong>!logout</strong> - Log out</li>\n                                <li><strong>!frog</strong> - <img src="assets/emojis/frog.gif" alt="frog" style="height: 2rem; user-select: none; pointer-events: none; draggable: false;"></li>\n                            </ul>\n                            <p class="mb-0">But don\'t tell anyone! <i class="far fa-smile-wink"></i></p>\n                        </div>\n                    </div>\n                </li>';return $("#messages").append(e),!0}if("!clear"==$("#messageArea").val())return $("#messageArea").val(""),$("#messages").html(""),!0;if($("#messageArea").val().startsWith("!theme")){if("!theme"==$("#messageArea").val())return $("#messageArea").val(""),$("#themeModal").modal("show"),!0;var a=$("#messageArea").val().split(" ")[1],t=!1;if($.each(window.themes,(function(e,s){s.name.toLowerCase()==a.toLowerCase()&&(t=!0,setBootswatchTheme(s.url))})),t){if("!theme vapor"==$("#messageArea").val()){const e='<li class="list-group-item" data-hash="secret-vapor">\n                    <div class="row">\n                        <div class="col-12 user-select-none">\n                            <p class="mb-0 fw-bold">Secret theme unlocked!</p>\n                            <p class="mb-0">You have unlocked the secret theme <strong>Vapor</strong>! Enjoy!</p>\n                            <p class="mb-0">This is a secret theme, only a few people know about it. You are one of them now! <i class="far fa-smile-wink"></i></p>\n                            <p class="mb-0 text-muted">This message will self-destruct in 10 seconds</p>\n                        </div>\n                    </div>\n                </li>';$("#messages").append(e),setTimeout((function(){$('li[data-hash="secret-vapor"]').remove()}),1e4)}return $("#messageArea").val(""),$("#themeModal").modal("hide"),!0}return $("#error").html("Theme not found"),$("#messageArea").val(""),!0}return"!reload"==$("#messageArea").val()?($("#messageArea").val(""),$("#messages").html(""),window.lastMsgHash=0,loadData(),!0):"!logout"==$("#messageArea").val()?($("#messageArea").val(""),logOut(),!0):void 0}function setFaviconCount(e){$("#faviconCountSwitch").is(":checked")?(null==window.favicon&&(window.favicon=new Favico({animation:"pop"})),e>0?(document.title="("+e+") "+window.config.title,window.favicon.badge(e)):(document.title=window.config.title,window.favicon.badge(0))):document.title=window.config.title}function confetti(){$.each($(".particletext.confetti"),(function(){for(var e=$(this).width()/50*10,a=0;a<=e;a++)$(this).append('<span class="particle c'+$.rnd(1,2)+'" style="top:'+$.rnd(10,50)+"%; left:"+$.rnd(0,100)+"%;width:"+$.rnd(6,8)+"px; height:"+$.rnd(3,4)+"px;animation-delay: "+$.rnd(0,30)/10+'s;"></span>')}))}$(document).on("click",(function(e){e.target.classList.contains("msg-url")&&linkOpen(e.target)})),$(document).on("click",(function(e){e.target.classList.contains("useTheme")&&setBootswatchTheme(e.target.dataset.theme)})),jQuery.rnd=function(e,a){return e=parseInt(e),a=parseInt(a),Math.floor(Math.random()*(a-e+1))+e},$("#sendBtn").click((function(){runcommands($("#messageArea").val())||sendMessage()})),$("#chatForm").submit((function(e){e.preventDefault(),runcommands($("#messageArea").val())||$("#sendBtn").is(":disabled")||sendMessage()})),$(".form-check-input").on("change",(function(){saveSettings()})),$(document).on("mouseenter",".thumbnail",(function(){var e=setTimeout((function(){a.matches(":hover")&&centerThumbnail(a)}),500),a=this;a.addEventListener("mouseleave",(function(){clearTimeout(e)}))})),$(document).on("mouseleave",".thumbnail",(function(){this.classList.remove("thumbnail-left"),this.classList.remove("thumbnail-right"),this.classList.remove("thumbnail-hover")})),$("#openUrlBtn").click((function(){$("#urlWarningModal").hasClass("show")&&window.open(document.getElementById("urlInput").value,"_blank")})),$("#urlWarningModal").on("hidden.bs.modal",(function(){document.getElementById("urlInput").value="",document.getElementById("urlFavicon").src=""})),$("#neverShowAgainBtn").click((function(){$("#neverShowAgainBtn").html("Are you sure?"),$("#neverShowAgainBtn").click((function(){saveToStorage("hideUrlWarning",!0),loadSettings(),$("#urlWarningModal").modal("hide")}))})),$("#darkModeSwitch").on("change",(function(){$(this).is(":checked")?setTheme("dark"):setTheme("light"),loadBootswatchThemeList()})),$("#faviconCountSwitch").on("change",(function(){saveSettings()})),$("#hideSpamSwitch").on("change",(function(){saveSettings(),$(this).is(":checked")?$('[data-spam="true"]').each((function(){$(this).hasClass("d-none")||$(this).addClass("d-none")})):$('[data-spam="true"]').each((function(){$(this).hasClass("d-none")&&$(this).removeClass("d-none")}))})),$("#logoutBtn").click((function(){logOut()})),$("#reloadCaptchaBtn").click((function(){var e=document.getElementById("iconCaptchaIframe").src;e=e.split("&r=")[0]+"&r="+Math.floor(1e3*Math.random()),document.getElementById("iconCaptchaIframe").src=e})),$(window).focus((function(){updateActivity()})),$(document).ready((function(){$("#messages").scrollTop($("#messages")[0].scrollHeight),"dark"==loadTheme()&&$("#darkModeSwitch").prop("checked",!0),null==localStorage.getItem("chat-settings")&&saveSettings(),loadSettings(),loadBootswatchThemeList(),$("#faviconCountSwitch").is(":checked")?window.favicon=new Favico({animation:"popFade"}):($("head").append('<link rel="icon" type="image/png" sizes="32x32" href="./assets/favicon/favicon-32x32.png">'),$("head").append('<link rel="icon" type="image/png" sizes="16x16" href="./assets/favicon/favicon-16x16.png">')),updateActivity(!0)}));